<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE Map[]>
<Map srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">

<Parameters>
  <Parameter name="center">6.0988,49.7915,10</Parameter>
  <Parameter name="format">pbf</Parameter>
  <Parameter name="json"><![CDATA[{"vector_layers":[{"id":"bridge","description":"","fields":{"class":"String","z_order":"Number"}},{"id":"road","description":"","fields":{"class":"String","z_order":"Number"}},{"id":"landuse","description":"","fields":{"class":"String","z_order":"Number"}},{"id":"waterway","description":"","fields":{"class":"String","width":"String","z_order":"Number"}},{"id":"water","description":"","fields":{}},{"id":"admin","description":"","fields":{"admin_level":"String","maritime":"Number"}},{"id":"place_label","description":"","fields":{"osm_id":"Number","name":"String","type":"String","ldir":"String","localrank":"Number"}},{"id":"country_label","description":"","fields":{"name":"String","scalerank":"Number"}}]}]]></Parameter>
  <Parameter name="maxzoom">13</Parameter>
  <Parameter name="minzoom">4</Parameter>
  <Parameter name="name"><![CDATA[osm2pgsql-osm-bright]]></Parameter>
</Parameters>


<Layer name="bridge"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[gis]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508.34,-20037508.34,20037508.34,20037508.34]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(select 'main' AS class, z_order, way from planet_osm_roads where bridge='yes' AND way && !bbox!) bridge]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="road"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[gis]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508.34,-20037508.34,20037508.34,20037508.34]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(select 'main' AS class, z_order, way from planet_osm_roads where bridge is null and tunnel is null AND way && !bbox!) road]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="landuse"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[gis]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508.34,-20037508.34,20037508.34,20037508.34]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(
SELECT landuse AS class, z_order, way
  FROM planet_osm_polygon
  WHERE
    landuse IN ('cemetery', 'hospital')
    AND z(!scale_denominator!) >= 10
    AND way && !bbox!
UNION ALL
SELECT 'park' AS class, z_order, way
  FROM planet_osm_polygon
  WHERE
    (
      landuse IN ('park', 'village_green', 'playground')
      AND z(!scale_denominator!) >= 10
    ) OR (
      landuse IN ('nature_reserve', 'national_reserve', 'conservation',
              'national_park')
      AND z(!scale_denominator!) >= 7
    )
    AND way && !bbox!
UNION ALL
SELECT 'school' AS class, z_order, way
  FROM planet_osm_polygon
  WHERE
    landuse IN ('school', 'university')
    AND z(!scale_denominator!) >= 10
    AND way && !bbox!
UNION ALL
SELECT 'wood' AS class, z_order, way
  FROM planet_osm_polygon
  WHERE
    landuse IN ('wood', 'forest')
    AND z(!scale_denominator!) >= 7
    AND way && !bbox!
) landuse]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="waterway"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[gis]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508.34,-20037508.34,20037508.34,20037508.34]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(select waterway AS class, width, z_order, way from planet_osm_line where waterway is not null AND way && !bbox!) waterway]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="water"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[gis]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508.34,-20037508.34,20037508.34,20037508.34]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(
SELECT way
  FROM planet_osm_polygon
  WHERE
    (
      "natural" = 'water'
      OR landuse = 'reservoir'
      OR landuse = 'pond'
    )
    AND way && !bbox!
) water]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="admin"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[gis]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508.34,-20037508.34,20037508.34,20037508.34]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(
SELECT admin_level, way, 0 AS maritime
  FROM planet_osm_polygon
  WHERE
    boundary = 'administrative'
    AND (
      admin_level = '2'
      OR ( admin_level = '4' AND z(!scale_denominator!) >= 5 )
    )
    AND way && !bbox!
) admin]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="place_label"
  buffer-size="64"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[gis]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508.34,-20037508.34,20037508.34,20037508.34]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(
SELECT DISTINCT ON(labelgrid(way, 64, !pixel_width!)) * FROM(
/* TODO calculate real ranks and ldir */
SELECT way, osm_id, name, place AS "type",
    'SE' AS ldir, 1 AS localrank
  FROM planet_osm_point
  WHERE
    place = 'city'
    AND way && !bbox!
UNION ALL
SELECT way, osm_id, name, place AS "type",
    'SE' AS ldir, 1 AS localrank
  FROM planet_osm_point
  WHERE
    place = 'town'
    AND z(!scale_denominator!) >= 7
    AND way && !bbox!
UNION ALL
SELECT way, osm_id, name, place AS "type",
    'SE' AS ldir, 1 AS localrank
  FROM planet_osm_point
  WHERE
    place = 'village'
    AND z(!scale_denominator!) >= 11
    AND way && !bbox!
UNION ALL
SELECT way, osm_id, name, place AS "type",
    'SE' AS ldir, 1 AS localrank
  FROM planet_osm_point
  WHERE
    place IN ('hamlet', 'suburb','neighbourhood')
    AND z(!scale_denominator!) >= 13
    AND way && !bbox!
) data
) place_label]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="country_label"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[gis]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508.34,-20037508.34,20037508.34,20037508.34]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(
SELECT way, name, CASE
      WHEN CAST(population AS int) >= 250000000 THEN 1
      WHEN CAST(population AS int) >= 100000000 AND CAST(population AS int) < 250000000 THEN 2
      WHEN CAST(population AS int) >= 50000000 AND CAST(population AS int) < 100000000 THEN 3
      WHEN CAST(population AS int) >= 25000000 AND CAST(population AS int) < 50000000 THEN 4
      WHEN CAST(population AS int) >= 10000000 AND CAST(population AS int) < 25000000 THEN 5
      WHEN CAST(population AS int) < 10000000 THEN 6
    END scalerank
  FROM planet_osm_point
  WHERE
    place = 'country'
    AND way && !bbox!
) country_label]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

</Map>